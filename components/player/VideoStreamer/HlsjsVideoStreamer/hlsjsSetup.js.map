{"version":3,"sources":["../../../../src/replay/components/player/VideoStreamer/HlsjsVideoStreamer/hlsjsSetup.js"],"names":["broadcastHlsInstance","instanceKeeper","preposition","hls","subscribers","forEach","subscriber","debugEnabledLogLevels","hlsjsSetup","videoElement","configuration","Promise","resolve","reject","Hls","isSupported","customConfiguration","hlsjs","hlsConfig","autoStartLoad","debug","indexOf","logLevel","on","Events","MEDIA_ATTACHED","attachMedia","PlaybackError","hlsjsCleanup","stopLoad","destroy"],"mappings":";;;;;;;;;AACA;;AAEA;;;;;;;;;;AAEO,SAASA,oBAAT,CAA8BC,cAA9B,EAAmEC,WAAnE,EAA8F;AAAA,QAC3FC,GAD2F,GACnFF,cADmF,CAC3FE,GAD2F;AAEnGA,EAAAA,GAAG,IAAIF,cAAc,CAACG,WAAf,CAA2BC,OAA3B,CAAmCC,UAAU,IAAIA,UAAU,CAACH,GAAD,EAAMD,WAAN,CAA3D,CAAP;AACD;;AAED,MAAMK,qBAAqB,GAAG,CAAC,OAAD,EAAU,SAAV,EAAqB,MAArB,CAA9B;;AAEO,SAASC,UAAT,CACLC,YADK,EAELC,aAFK,EAGS;AACd,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,QAAIC,aAAIC,WAAJ,EAAJ,EAAuB;AACrB,YAAMC,mBAAmB,GAAGN,aAAa,IAAIA,aAAa,CAACO,KAA/B,IAAwCP,aAAa,CAACO,KAAd,CAAoBD,mBAAxF;;AACA,YAAME,SAAc;AAClBC,QAAAA,aAAa,EAAE,KADG;AAElBC,QAAAA,KAAK,EAAEV,aAAa,IAAIH,qBAAqB,CAACc,OAAtB,CAA8BX,aAAa,CAACY,QAA5C,KAAyD;AAF/D,SAGfN,mBAHe,CAApB;;AAKA,YAAMb,GAAG,GAAG,IAAIW,YAAJ,CAAQI,SAAR,CAAZ;AACAf,MAAAA,GAAG,CAACoB,EAAJ,CAAOT,aAAIU,MAAJ,CAAWC,cAAlB,EAAkC,MAAM;AACtCb,QAAAA,OAAO,CAACT,GAAD,CAAP;AACD,OAFD;AAGAA,MAAAA,GAAG,CAACuB,WAAJ,CAAgBjB,YAAhB;AACD,KAZD,MAYO;AACLI,MAAAA,MAAM,CACJ,IAAIc,oBAAJ,CAAkB,qCAAlB,EAAyD,OAAzD,EAAkE,0CAAlE,CADI,CAAN;AAGD;AACF,GAlBM,CAAP;AAmBD;;AAEM,SAASC,YAAT,CAAsB3B,cAAtB,EAA2D;AAAA,QACxDE,GADwD,GAChDF,cADgD,CACxDE,GADwD;;AAEhE,MAAIA,GAAJ,EAAS;AACPA,IAAAA,GAAG,CAAC0B,QAAJ;AACA7B,IAAAA,oBAAoB,CAACC,cAAD,EAAiB,KAAjB,CAApB;AACA,WAAOU,OAAO,CAACC,OAAR,CAAgBT,GAAG,CAAC2B,OAAJ,EAAhB,CAAP;AACD,GAJD,MAIO;AACL,WAAOnB,OAAO,CAACC,OAAR,EAAP;AACD;AACF","sourcesContent":["// @flow\nimport Hls from 'hls.js';\nimport type { HlsjsInstanceKeeper, HlsjsVideoStreamerConfiguration } from './HlsjsVideoStreamer';\nimport { PlaybackError } from '../types';\n\nexport function broadcastHlsInstance(instanceKeeper: HlsjsInstanceKeeper, preposition: 'on' | 'off') {\n  const { hls } = instanceKeeper;\n  hls && instanceKeeper.subscribers.forEach(subscriber => subscriber(hls, preposition));\n}\n\nconst debugEnabledLogLevels = ['DEBUG', 'VERBOSE', 'INFO'];\n\nexport function hlsjsSetup(\n  videoElement: HTMLVideoElement,\n  configuration: ?HlsjsVideoStreamerConfiguration\n): Promise<Hls> {\n  return new Promise((resolve, reject) => {\n    if (Hls.isSupported()) {\n      const customConfiguration = configuration && configuration.hlsjs && configuration.hlsjs.customConfiguration;\n      const hlsConfig: any = {\n        autoStartLoad: false,\n        debug: configuration && debugEnabledLogLevels.indexOf(configuration.logLevel) >= 0,\n        ...customConfiguration\n      };\n      const hls = new Hls(hlsConfig);\n      hls.on(Hls.Events.MEDIA_ATTACHED, () => {\n        resolve(hls);\n      });\n      hls.attachMedia(videoElement);\n    } else {\n      reject(\n        new PlaybackError('STREAM_ERROR_TECHNOLOGY_UNSUPPORTED', 'hlsjs', 'Hls.js is not supported in this browser.')\n      );\n    }\n  });\n}\n\nexport function hlsjsCleanup(instanceKeeper: HlsjsInstanceKeeper) {\n  const { hls } = instanceKeeper;\n  if (hls) {\n    hls.stopLoad();\n    broadcastHlsInstance(instanceKeeper, 'off');\n    return Promise.resolve(hls.destroy());\n  } else {\n    return Promise.resolve();\n  }\n}\n"],"file":"hlsjsSetup.js"}